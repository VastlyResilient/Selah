<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Selah â€” The Word</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;0,700;1,300;1,400;1,600&family=Jost:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root { --gold:#C6A75E; --gold-light:#D4B97A; --muted:rgba(255,255,255,0.58); }

/* â”€â”€ DEFAULT IS DARK (deep navy) â”€â”€ */

/* â”€â”€ LIGHT MODE overrides â”€â”€ */
body.light-mode {
  color: #1a2744;
}
body.light-mode .bg-gradient {
  background: linear-gradient(145deg,#e8f0ff 0%,#dce8ff 20%,#eaf0ff 40%,#d8e6ff 60%,#e4edff 80%,#d0e0ff 100%) !important;
  animation: none;
}
body.light-mode .blob1 { background: radial-gradient(circle,rgba(198,167,94,0.45),transparent 70%); opacity:0.55; }
body.light-mode .blob2 { background: radial-gradient(circle,rgba(100,150,255,0.3),transparent 70%); opacity:0.45; }
body.light-mode .blob3 { background: radial-gradient(circle,rgba(180,200,255,0.35),transparent 70%); opacity:0.4; }
body.light-mode #particles { opacity: 0.3; }

body.light-mode nav {
  background: linear-gradient(135deg,rgba(255,255,255,0.72) 0%,rgba(255,255,255,0.52) 100%);
  border-bottom: 1px solid rgba(100,140,220,0.15);
  box-shadow: 0 4px 24px rgba(60,90,160,0.07);
}
body.light-mode .nav-logo { color: #1a2744; }
body.light-mode .nav-links a { color: rgba(26,39,68,0.55); }
body.light-mode .nav-links a:hover, body.light-mode .nav-links a.active { color: var(--gold); }

body.light-mode .sidebar {
  background: linear-gradient(180deg,rgba(255,255,255,0.68) 0%,rgba(255,255,255,0.48) 100%);
  border-right: 1px solid rgba(100,140,220,0.12);
}
body.light-mode .testament-label { color: rgba(26,39,68,0.35); }
body.light-mode .book-btn { color: rgba(26,39,68,0.62); }
body.light-mode .book-btn:hover { background: rgba(60,100,220,0.07); color: #1a2744; border-left-color: rgba(60,100,220,0.2); }
body.light-mode .book-btn.active { background: linear-gradient(90deg,rgba(198,167,94,0.15) 0%,rgba(198,167,94,0.04) 100%); color: var(--gold); }

body.light-mode .reader-header {
  background: linear-gradient(135deg,rgba(255,255,255,0.75) 0%,rgba(255,255,255,0.55) 100%);
  border: 1px solid rgba(100,140,220,0.15);
  box-shadow: 0 8px 28px rgba(60,90,160,0.06), inset 0 2px 0 rgba(255,255,255,0.95);
}
body.light-mode .reader-book-title { color: #1a2744; }
body.light-mode .translation-badge { background: rgba(198,167,94,0.12); }
body.light-mode .chapter-select { background: rgba(255,255,255,0.65); border-color: rgba(100,140,220,0.18); color: #1a2744; box-shadow: none; }
body.light-mode .chapter-select option { background: #e8f0ff; color: #1a2744; }
body.light-mode .ch-btn { background: rgba(255,255,255,0.65); border-color: rgba(100,140,220,0.18); color: #1a2744; box-shadow: none; }
body.light-mode .ch-btn:hover { background: rgba(198,167,94,0.15); border-color: var(--gold); }
body.light-mode .read-progress-wrap { background: rgba(60,90,160,0.08); }

body.light-mode .glass {
  background: linear-gradient(135deg,rgba(255,255,255,0.75) 0%,rgba(255,255,255,0.55) 100%);
  border: 1px solid rgba(255,255,255,0.88);
  box-shadow: 0 16px 48px rgba(60,90,160,0.07), inset 0 2px 0 rgba(255,255,255,0.98), inset 0 -1px 0 rgba(60,90,160,0.03);
}
body.light-mode .reader-card p { color: rgba(15,28,60,0.86) !important; }

/* â”€â”€ DARK MODE (deep navy) overrides â”€â”€ */
body.dark-mode .bg-gradient {
  background: linear-gradient(145deg,#0d1b2e 0%,#0f2040 18%,#111d35 35%,#0a1628 52%,#0e1f38 68%,#091524 85%,#0d1b2e 100%) !important;
}
body.dark-mode .blob1 { background: radial-gradient(circle,rgba(198,167,94,0.28),transparent 70%); opacity:0.7; }
body.dark-mode .blob2 { background: radial-gradient(circle,rgba(60,100,200,0.4),transparent 70%); opacity:0.55; }
body.dark-mode .blob3 { background: radial-gradient(circle,rgba(120,80,200,0.25),transparent 70%); opacity:0.45; }

body.dark-mode nav {
  background: linear-gradient(135deg,rgba(255,255,255,0.06) 0%,rgba(255,255,255,0.03) 100%);
  border-bottom: 1px solid rgba(255,255,255,0.08);
}
body.dark-mode .sidebar {
  background: linear-gradient(180deg,rgba(255,255,255,0.05) 0%,rgba(255,255,255,0.02) 100%);
  border-right: 1px solid rgba(255,255,255,0.07);
}
body.dark-mode .glass {
  background: linear-gradient(135deg,rgba(255,255,255,0.10) 0%,rgba(255,255,255,0.05) 100%);
  border: 1px solid rgba(255,255,255,0.14);
  box-shadow: 0 16px 48px rgba(0,0,0,0.35), inset 0 2px 0 rgba(255,255,255,0.12), inset 0 -1px 0 rgba(255,255,255,0.04);
}
body.dark-mode .reader-header {
  background: linear-gradient(135deg,rgba(255,255,255,0.10) 0%,rgba(255,255,255,0.05) 100%);
  border: 1px solid rgba(255,255,255,0.14);
  box-shadow: 0 8px 28px rgba(0,0,0,0.3), inset 0 2px 0 rgba(255,255,255,0.12);
}
body.dark-mode .chapter-select { background: rgba(255,255,255,0.07); border-color: rgba(255,255,255,0.12); }
body.dark-mode .chapter-select option { background: #0f1f3a; }
body.dark-mode .ch-btn { background: rgba(255,255,255,0.07); border-color: rgba(255,255,255,0.12); }
body.dark-mode .reader-card p { color: rgba(255,255,255,0.82) !important; }
body.dark-mode .read-progress-wrap { background: rgba(255,255,255,0.06); }

/* Mode toggle */
.mode-toggle {
  display:flex; align-items:center; gap:7px;
  padding:7px 16px;
  background:rgba(255,255,255,0.12);
  border:1px solid rgba(255,255,255,0.24);
  border-radius:100px;
  font-family:'Jost',sans-serif; font-size:0.72rem; font-weight:600;
  letter-spacing:0.06em; color:rgba(255,255,255,0.78);
  cursor:pointer; transition:all 0.3s ease;
  backdrop-filter:blur(14px);
  -webkit-backdrop-filter:blur(14px);
  box-shadow:inset 0 1px 0 rgba(255,255,255,0.22);
}
.mode-toggle:hover { background:rgba(255,255,255,0.2); color:white; }
body.light-mode .mode-toggle { background:rgba(255,255,255,0.55); border-color:rgba(100,140,220,0.18); color:#1a2744; box-shadow:inset 0 1px 0 rgba(255,255,255,0.9); }
body.light-mode .mode-toggle:hover { background:rgba(255,255,255,0.75); }
body.dark-mode .mode-toggle { background:rgba(255,255,255,0.06); border-color:rgba(255,255,255,0.12); }
.mode-icon { font-size:0.88rem; transition:transform 0.4s ease; }
.mode-toggle:hover .mode-icon { transform:rotate(20deg); }
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
html{scroll-behavior:smooth;}
body{font-family:'Jost',sans-serif;background:#3a5a8f;color:white;min-height:100vh;overflow-x:hidden;}

/* SHOOTING STARS */
.shooting-star{position:fixed;top:0;left:0;width:2px;height:2px;border-radius:50%;pointer-events:none;z-index:0;opacity:0;}
@keyframes shootStar{
  0%{opacity:0;transform:translate(0,0) scaleX(1);}
  5%{opacity:1;}
  80%{opacity:0.6;}
  100%{opacity:0;transform:translate(var(--sx),var(--sy)) scaleX(1);}
}
/* BG */
.bg-canvas{position:fixed;inset:0;z-index:0;overflow:hidden;}
.bg-gradient{position:absolute;inset:0;background:linear-gradient(145deg,#5a80c0 0%,#4a70b5 15%,#6080c8 32%,#4a6ab0 50%,#5578c0 68%,#4060a8 85%,#5070b8 100%);animation:breathe 50s ease-in-out infinite;}
@keyframes breathe{0%,100%{filter:brightness(1);}35%{filter:brightness(1.08);}70%{filter:brightness(0.95);}}
.bg-blob{position:absolute;border-radius:50%;filter:blur(90px);animation:floatBlob 25s ease-in-out infinite;}
.blob1{width:700px;height:700px;background:radial-gradient(circle,rgba(198,167,94,0.4),transparent 70%);top:-200px;left:-150px;opacity:0.8;}
.blob2{width:600px;height:600px;background:radial-gradient(circle,rgba(180,210,255,0.5),transparent 70%);bottom:0;right:-150px;opacity:0.65;animation-delay:-12s;}
.blob3{width:500px;height:500px;background:radial-gradient(circle,rgba(200,180,240,0.35),transparent 70%);top:40%;left:20%;opacity:0.5;animation-delay:-6s;}
@keyframes floatBlob{0%,100%{transform:translate(0,0);}50%{transform:translate(18px,-14px);}}
#particles{position:absolute;inset:0;pointer-events:none;}
.page{position:relative;z-index:1;}

/* GLASS */
.glass{
  background:linear-gradient(135deg,rgba(255,255,255,0.26) 0%,rgba(255,255,255,0.12) 100%);
  backdrop-filter:blur(32px) saturate(1.6);
  -webkit-backdrop-filter:blur(32px) saturate(1.6);
  border:1px solid rgba(255,255,255,0.42);
  box-shadow:0 16px 48px rgba(0,0,0,0.10),inset 0 2px 0 rgba(255,255,255,0.52),inset 0 -1px 0 rgba(255,255,255,0.08),inset 1px 0 0 rgba(255,255,255,0.18);
  border-radius:20px;
}

/* NAV */
nav{position:fixed;top:0;left:0;right:0;z-index:100;padding:16px 50px;display:flex;align-items:center;justify-content:space-between;background:linear-gradient(135deg,rgba(255,255,255,0.18) 0%,rgba(255,255,255,0.08) 100%);backdrop-filter:blur(36px) saturate(1.5);-webkit-backdrop-filter:blur(36px) saturate(1.5);border-bottom:1px solid rgba(255,255,255,0.25);box-shadow:0 4px 24px rgba(0,0,0,0.06),inset 0 -1px 0 rgba(255,255,255,0.1);}
.nav-logo{font-family:'Cormorant Garamond',serif;font-size:1.6rem;font-weight:600;letter-spacing:0.06em;color:white;text-decoration:none;}
.nav-logo span{color:var(--gold);}
.nav-links{display:flex;gap:28px;list-style:none;}
.nav-links a{font-size:0.76rem;font-weight:500;letter-spacing:0.12em;text-transform:uppercase;color:rgba(255,255,255,0.6);text-decoration:none;transition:color 0.2s;}
.nav-links a:hover,.nav-links a.active{color:var(--gold);}

/* LAYOUT */
.bible-layout{display:block;min-height:100vh;padding-top:65px;}

/* SIDEBAR */
.sidebar{
  position:fixed;top:65px;left:0;bottom:0;width:250px;
  overflow-y:auto;
  background:linear-gradient(180deg,rgba(255,255,255,0.16) 0%,rgba(255,255,255,0.08) 100%);
  backdrop-filter:blur(32px) saturate(1.4);
  -webkit-backdrop-filter:blur(32px) saturate(1.4);
  border-right:1px solid rgba(255,255,255,0.2);
  box-shadow:inset -1px 0 0 rgba(255,255,255,0.08),4px 0 20px rgba(0,0,0,0.05);
  padding:16px 0 40px;
  scrollbar-width:thin;
  scrollbar-color:rgba(198,167,94,0.3) transparent;
}
.sidebar::-webkit-scrollbar{width:3px;}
.sidebar::-webkit-scrollbar-thumb{background:rgba(198,167,94,0.3);border-radius:2px;}
.testament-label{font-size:0.58rem;font-weight:600;letter-spacing:0.2em;text-transform:uppercase;color:rgba(255,255,255,0.32);padding:18px 18px 8px;}
.book-btn{width:100%;padding:8px 18px;background:none;border:none;border-left:2px solid transparent;text-align:left;font-family:'Jost',sans-serif;font-size:0.83rem;color:rgba(255,255,255,0.62);cursor:pointer;transition:all 0.18s;}
.book-btn:hover{background:rgba(255,255,255,0.09);color:white;border-left-color:rgba(255,255,255,0.2);}
.book-btn.active{background:linear-gradient(90deg,rgba(198,167,94,0.18) 0%,rgba(198,167,94,0.05) 100%);color:var(--gold);border-left-color:var(--gold);font-weight:600;}

/* READER */
.reader-main{margin-left:250px;padding:28px 52px 80px;min-width:0;width:calc(100vw - 250px);}
.reader-header{display:flex;align-items:center;gap:14px;margin-bottom:20px;flex-wrap:wrap;background:linear-gradient(135deg,rgba(255,255,255,0.22) 0%,rgba(255,255,255,0.10) 100%);backdrop-filter:blur(28px) saturate(1.4);-webkit-backdrop-filter:blur(28px) saturate(1.4);border:1px solid rgba(255,255,255,0.35);box-shadow:0 8px 28px rgba(0,0,0,0.08),inset 0 2px 0 rgba(255,255,255,0.45);border-radius:16px;padding:14px 22px;}
.reader-book-title{font-family:'Cormorant Garamond',serif;font-size:1.6rem;font-weight:600;color:white;}
.translation-badge{padding:4px 11px;background:rgba(198,167,94,0.15);border:1px solid rgba(198,167,94,0.35);border-radius:100px;font-size:0.62rem;font-weight:600;letter-spacing:0.14em;text-transform:uppercase;color:var(--gold);}
.chapter-nav{display:flex;align-items:center;gap:8px;margin-left:auto;}
.ch-btn{width:32px;height:32px;border-radius:50%;background:rgba(255,255,255,0.12);border:1px solid rgba(255,255,255,0.25);box-shadow:inset 0 1px 0 rgba(255,255,255,0.3);color:white;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1rem;transition:all 0.2s;}
.ch-btn:hover{background:rgba(198,167,94,0.22);border-color:var(--gold);}
.ch-btn:disabled{opacity:0.3;cursor:not-allowed;}
.chapter-select-wrap{position:relative;}
.chapter-select{padding:7px 30px 7px 13px;background:rgba(255,255,255,0.12);border:1px solid rgba(255,255,255,0.25);box-shadow:inset 0 1px 0 rgba(255,255,255,0.22);border-radius:100px;font-family:'Jost',sans-serif;font-size:0.78rem;color:white;appearance:none;cursor:pointer;transition:all 0.2s;}
.chapter-select:focus{outline:none;border-color:var(--gold);}
.chapter-select option{background:#3a5a8f;}
.chapter-select-wrap::after{content:'â–¾';position:absolute;right:10px;top:50%;transform:translateY(-50%);color:var(--gold);pointer-events:none;font-size:0.72rem;}

/* PROGRESS */
.read-progress-wrap{height:2px;background:rgba(255,255,255,0.08);margin-bottom:24px;border-radius:1px;}
.read-progress-bar{height:100%;background:var(--gold);width:0%;transition:width 0.3s ease;border-radius:1px;}

/* READER CARD */
.reader-card{padding:40px 48px;min-height:60vh;width:100%;display:block;}
.reader-loading{text-align:center;padding:60px;color:var(--muted);font-family:'Cormorant Garamond',serif;font-style:italic;font-size:1.1rem;}
.reader-error{text-align:center;padding:60px;color:rgba(255,140,140,0.85);font-size:0.9rem;line-height:1.8;}

/* VERSE PROSE â€” THE KEY: everything inline, words wrap naturally */
.verse-prose{
  font-family:'Cormorant Garamond',serif;
  font-size:1.14rem;
  line-height:2.15;
  color:rgba(255,255,255,0.88);
  word-spacing:0.05em;
  width:100%;
  display:block;
  white-space:normal;
  word-break:normal;
  overflow-wrap:break-word;
}
.vn{
  font-size:0.58rem;font-weight:700;color:var(--gold);
  vertical-align:super;margin-right:3px;
  font-family:'Jost',sans-serif;letter-spacing:0.04em;
  line-height:0;
  display:inline;
}
.w{
  display:inline !important;
  cursor:pointer;border-radius:3px;padding:0 1px;
  transition:background 0.15s,color 0.15s;
  white-space:normal;
}
.w:hover{background:rgba(198,167,94,0.22);color:white;}

/* WORD POPUP */
.word-popup{
  position:fixed;z-index:500;
  max-width:290px;min-width:210px;
  padding:18px 20px 16px;
  background:linear-gradient(135deg,rgba(255,255,255,0.38) 0%,rgba(255,255,255,0.22) 100%);
  backdrop-filter:blur(44px) saturate(1.8);
  -webkit-backdrop-filter:blur(44px) saturate(1.8);
  border:1px solid rgba(255,255,255,0.52);
  box-shadow:0 20px 60px rgba(0,0,0,0.16),inset 0 2px 0 rgba(255,255,255,0.6),inset 0 -1px 0 rgba(255,255,255,0.1);
  border-radius:16px;
  display:none;
  animation:popIn 0.22s cubic-bezier(0.16,1,0.3,1);
}
@keyframes popIn{from{opacity:0;transform:scale(0.95) translateY(6px);}to{opacity:1;transform:scale(1) translateY(0);}}
.popup-close{position:absolute;top:10px;right:12px;background:rgba(255,255,255,0.15);border:none;color:rgba(255,255,255,0.6);cursor:pointer;font-size:0.75rem;width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:all 0.2s;}
.popup-close:hover{background:rgba(255,255,255,0.28);color:white;}
.popup-word{font-family:'Cormorant Garamond',serif;font-size:1.4rem;font-weight:600;color:white;margin-bottom:3px;}
.popup-pos{font-size:0.64rem;font-weight:600;letter-spacing:0.12em;text-transform:uppercase;color:var(--gold);margin-bottom:10px;}
.popup-def{font-size:0.84rem;color:rgba(255,255,255,0.85);line-height:1.65;}
.popup-example{margin-top:8px;padding-top:8px;border-top:1px solid rgba(255,255,255,0.12);font-size:0.76rem;color:rgba(255,255,255,0.45);font-style:italic;line-height:1.6;}
.popup-loading{font-size:0.84rem;color:rgba(255,255,255,0.45);font-style:italic;}

@media(max-width:768px){
  nav{padding:13px 18px;}
  .nav-links{display:none;}
  .bible-layout{grid-template-columns:1fr;}
  .sidebar{width:100%;height:180px;position:relative;top:0;border-right:none;border-bottom:1px solid rgba(255,255,255,0.12);display:flex;flex-wrap:wrap;padding:8px;overflow-x:auto;overflow-y:hidden;align-content:flex-start;}
  .testament-label{width:100%;padding:6px 8px 3px;}
  .book-btn{width:auto;padding:5px 12px;border-left:none;border-bottom:2px solid transparent;font-size:0.78rem;}
  .book-btn.active{border-left:none;border-bottom-color:var(--gold);}
  .reader-main{margin-left:0;padding:16px 16px 60px;width:100%;}
  .reader-card{padding:22px 18px;}
}
</style>
</head>
<body>
<div class="bg-canvas">
  <div class="bg-gradient"></div>
  <div class="bg-blob blob1"></div>
  <div class="bg-blob blob2"></div>
  <div class="bg-blob blob3"></div>
  <canvas id="particles"></canvas>
</div>

<div class="word-popup" id="wordPopup">
  <button class="popup-close" onclick="closePopup()">âœ•</button>
  <div class="popup-word" id="popupWord"></div>
  <div class="popup-pos" id="popupPos"></div>
  <div class="popup-def" id="popupDef"><span class="popup-loading">Looking upâ€¦</span></div>
  <div class="popup-example" id="popupExample"></div>
</div>

<div class="page">
<nav>
  <a href="/" class="nav-logo"><span>S</span>elah</a>
  <ul class="nav-links">
    <li><a href="/">Home</a></li>
    <li><a href="/prayer.html">Prayer Wall</a></li>
    <li><a href="/bible.html" class="active">The Word</a></li>
  </ul>
  <div style="display:flex;align-items:center;gap:10px;">
    <button class="mob-books-btn" onclick="openMobSidebar()">ðŸ“– Books</button>
    <button class="mode-toggle" id="modeToggle" onclick="toggleMode()">
    <span class="mode-icon" id="modeIcon">ðŸŒ™</span>
    <span id="modeLabel">Dark</span>
  </button>
  </div>
</nav>
<div class="mob-sidebar-overlay" id="mobOverlay" onclick="closeMobSidebar()"></div>

<div class="bible-layout">
  <div class="sidebar" id="sidebar"><div id="bookList"></div></div>
  <div class="reader-main">
    <div class="reader-header">
      <div class="reader-book-title" id="readerTitle">Genesis</div>
      <div class="translation-badge">WEB</div>
      <div class="chapter-nav">
        <button class="ch-btn" id="prevBtn" onclick="changeChapter(-1)">â€¹</button>
        <div class="chapter-select-wrap">
          <select class="chapter-select" id="chSel" onchange="loadChapter()"></select>
        </div>
        <button class="ch-btn" id="nextBtn" onclick="changeChapter(1)">â€º</button>
      </div>
    </div>
    <div class="read-progress-wrap"><div class="read-progress-bar" id="prog"></div></div>
    <div class="reader-card glass" id="card"><div class="reader-loading">Opening the Wordâ€¦</div></div>
  </div>
</div>
</div>

<script>
// PARTICLES
const cv=document.getElementById('particles'),cx=cv.getContext('2d');let ps=[];
function rsz(){cv.width=window.innerWidth;cv.height=window.innerHeight;}
function iPs(){ps=[];for(let i=0;i<40;i++)ps.push({x:Math.random()*cv.width,y:Math.random()*cv.height,r:Math.random()*1.2+0.3,o:Math.random()*0.18+0.04,vx:(Math.random()-.5)*.1,vy:-(Math.random()*.14+.03)});}
function dPs(){cx.clearRect(0,0,cv.width,cv.height);ps.forEach(p=>{cx.beginPath();cx.arc(p.x,p.y,p.r,0,Math.PI*2);cx.fillStyle=`rgba(198,167,94,${p.o})`;cx.fill();p.x+=p.vx;p.y+=p.vy;if(p.y<-5)p.y=cv.height+5;if(p.x<-5)p.x=cv.width+5;if(p.x>cv.width+5)p.x=-5;});requestAnimationFrame(dPs);}
rsz();iPs();dPs();window.addEventListener('resize',()=>{rsz();iPs();});

// BOOKS
const OT=[
  {name:'Genesis',c:50},{name:'Exodus',c:40},{name:'Leviticus',c:27},{name:'Numbers',c:36},
  {name:'Deuteronomy',c:34},{name:'Joshua',c:24},{name:'Judges',c:21},{name:'Ruth',c:4},
  {name:'1 Samuel',c:31},{name:'2 Samuel',c:24},{name:'1 Kings',c:22},{name:'2 Kings',c:25},
  {name:'1 Chronicles',c:29},{name:'2 Chronicles',c:36},{name:'Ezra',c:10},{name:'Nehemiah',c:13},
  {name:'Esther',c:10},{name:'Job',c:42},{name:'Psalms',c:150},{name:'Proverbs',c:31},
  {name:'Ecclesiastes',c:12},{name:'Song of Solomon',c:8},{name:'Isaiah',c:66},
  {name:'Jeremiah',c:52},{name:'Lamentations',c:5},{name:'Ezekiel',c:48},{name:'Daniel',c:12},
  {name:'Hosea',c:14},{name:'Joel',c:3},{name:'Amos',c:9},{name:'Obadiah',c:1},
  {name:'Jonah',c:4},{name:'Micah',c:7},{name:'Nahum',c:3},{name:'Habakkuk',c:3},
  {name:'Zephaniah',c:3},{name:'Haggai',c:2},{name:'Zechariah',c:14},{name:'Malachi',c:4}
];
const NT=[
  {name:'Matthew',c:28},{name:'Mark',c:16},{name:'Luke',c:24},{name:'John',c:21},
  {name:'Acts',c:28},{name:'Romans',c:16},{name:'1 Corinthians',c:16},{name:'2 Corinthians',c:13},
  {name:'Galatians',c:6},{name:'Ephesians',c:6},{name:'Philippians',c:4},{name:'Colossians',c:4},
  {name:'1 Thessalonians',c:5},{name:'2 Thessalonians',c:3},{name:'1 Timothy',c:6},
  {name:'2 Timothy',c:4},{name:'Titus',c:3},{name:'Philemon',c:1},{name:'Hebrews',c:13},
  {name:'James',c:5},{name:'1 Peter',c:5},{name:'2 Peter',c:3},{name:'1 John',c:5},
  {name:'2 John',c:1},{name:'3 John',c:1},{name:'Jude',c:1},{name:'Revelation',c:22}
];
const ALL=[...OT,...NT];
let curBook='Genesis',curCh=1,curData=OT[0];

function buildSidebar(){
  const list=document.getElementById('bookList');
  list.innerHTML='';

  function makeGroup(label, books){
    const grp=document.createElement('div');
    grp.className='testament-group';

    const toggle=document.createElement('button');
    toggle.className='testament-toggle';
    const isActive=books.some(b=>b.name===curBook);
    if(isActive)toggle.classList.add('open');
    toggle.innerHTML=label+'<span class="t-arrow">â€º</span>';
    toggle.onclick=function(){
      toggle.classList.toggle('open');
      booksDiv.classList.toggle('open');
    };
    grp.appendChild(toggle);

    const booksDiv=document.createElement('div');
    booksDiv.className='testament-books'+(isActive?' open':'');
    books.forEach(b=>{
      const btn=document.createElement('button');
      btn.className='book-btn'+(b.name===curBook?' active':'');
      btn.textContent=b.name;
      btn.onclick=()=>{selectBook(b.name);closeMobSidebar();};
      booksDiv.appendChild(btn);
    });
    grp.appendChild(booksDiv);
    list.appendChild(grp);
  }

  makeGroup('Old Testament', OT);
  makeGroup('New Testament', NT);
}

function openMobSidebar(){
  document.getElementById('sidebar').classList.add('mob-open');
  document.getElementById('mobOverlay').classList.add('open');
}
function closeMobSidebar(){
  document.getElementById('sidebar').classList.remove('mob-open');
  document.getElementById('mobOverlay').classList.remove('open');
}

function selectBook(name){
  curBook=name;curCh=1;curData=ALL.find(b=>b.name===name);
  buildSidebar();buildChSel();loadChapter();
  const a=document.querySelector('.book-btn.active');
  if(a)a.scrollIntoView({block:'nearest',behavior:'smooth'});
}

function buildChSel(){
  const s=document.getElementById('chSel');s.innerHTML='';
  for(let i=1;i<=curData.c;i++){
    const o=document.createElement('option');o.value=i;o.textContent='Chapter '+i;
    if(i===curCh)o.selected=true;s.appendChild(o);
  }
}

function changeChapter(d){
  const n=curCh+d;if(n<1||n>curData.c)return;
  curCh=n;document.getElementById('chSel').value=n;loadChapter();
}

async function loadChapter(){
  curCh=parseInt(document.getElementById('chSel').value);
  document.getElementById('readerTitle').textContent=curBook;
  document.getElementById('card').innerHTML='<div class="reader-loading">Opening the Wordâ€¦</div>';
  document.getElementById('prog').style.width='0%';
  document.getElementById('prevBtn').disabled=curCh<=1;
  document.getElementById('nextBtn').disabled=curCh>=curData.c;
  try{
    const r=await fetch('https://bible-api.com/'+encodeURIComponent(curBook+' '+curCh)+'?translation=web');
    const d=await r.json();
    if(!d.verses||!d.verses.length)throw new Error('empty');
    renderVerses(d.verses);
  }catch(e){
    document.getElementById('card').innerHTML='<div class="reader-error">Could not load this chapter.<br>Please check your internet connection.</div>';
  }
}

// RENDER â€” DOM-based, proper inline flow
function renderVerses(verses){
  var card=document.getElementById('card');
  card.innerHTML='';

  // Outer paragraph â€” block, full width, wraps naturally
  var para=document.createElement('p');
  para.style.fontFamily='Cormorant Garamond,serif';
  para.style.fontSize='1.14rem';
  para.style.lineHeight='2.2';
  para.style.color='rgba(255,255,255,0.88)';
  para.style.wordWrap='break-word';
  para.style.whiteSpace='normal';
  para.style.width='100%';
  para.style.display='block';
  para.style.margin='0';
  para.style.padding='0';

  verses.forEach(function(v,vi){
    // Verse number superscript
    var vn=document.createElement('sup');
    vn.textContent=v.verse;
    vn.style.fontSize='0.58rem';
    vn.style.fontWeight='700';
    vn.style.color='#C6A75E';
    vn.style.marginRight='3px';
    vn.style.fontFamily='Jost,sans-serif';
    para.appendChild(vn);

    // Split verse text into words
    var words=(v.text||'').trim().split(' ');
    for(var i=0;i<words.length;i++){
      var word=words[i];
      var clean=word.replace(/[^a-zA-Z]/g,'');
      var span=document.createElement('span');
      span.textContent=word;
      span.style.display='inline';
      span.style.fontFamily='Cormorant Garamond,serif';
      if(clean.length>1){
        span.style.cursor='pointer';
        span.style.borderRadius='3px';
        span.style.padding='0 1px';
        span.style.transition='background 0.15s,color 0.15s';
        (function(c,s){
          s.addEventListener('mouseover',function(){s.style.background='rgba(198,167,94,0.22)';s.style.color='white';});
          s.addEventListener('mouseout',function(){s.style.background='';s.style.color='';});
          s.addEventListener('click',function(e){e.stopPropagation();lookUp(c,e);});
        })(clean,span);
      }
      para.appendChild(span);
      para.appendChild(document.createTextNode(' '));
    }

    // Breathing room every 6 verses
    if((vi+1)%6===0){
      para.appendChild(document.createElement('br'));
      para.appendChild(document.createElement('br'));
    }
  });

  card.appendChild(para);

  window.onscroll=function(){
    var total=document.body.scrollHeight-window.innerHeight;
    if(total>0)document.getElementById('prog').style.width=Math.min(100,(window.scrollY/total)*100)+'%';
  };
}

function escHtml(s){
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

// DEFINITIONS
var cache={};
function lookUp(word,e){
  e.stopPropagation();
  var popup=document.getElementById('wordPopup');
  var lw=word.toLowerCase();
  var x=Math.min(e.clientX+12,window.innerWidth-310);
  var y=Math.min(e.clientY+12,window.innerHeight-220);
  popup.style.left=x+'px';popup.style.top=y+'px';popup.style.display='block';
  document.getElementById('popupWord').textContent=word;
  document.getElementById('popupPos').textContent='';
  document.getElementById('popupDef').innerHTML='<span class="popup-loading">Looking upâ€¦</span>';
  document.getElementById('popupExample').textContent='';
  if(cache[lw]){applyDef(cache[lw]);return;}
  fetch('https://api.dictionaryapi.dev/api/v2/entries/en/'+encodeURIComponent(lw))
    .then(function(r){return r.json();})
    .then(function(data){
      if(Array.isArray(data)&&data[0]&&data[0].meanings&&data[0].meanings.length){
        var m=data[0].meanings[0];var d=m.definitions[0];
        var res={pos:m.partOfSpeech,def:d.definition,ex:d.example||''};
        cache[lw]=res;applyDef(res);
      }else{document.getElementById('popupDef').textContent='No definition found.';}
    })
    .catch(function(){document.getElementById('popupDef').textContent='Could not load definition.';});
}

function applyDef(r){
  document.getElementById('popupPos').textContent=r.pos;
  document.getElementById('popupDef').textContent=r.def;
  document.getElementById('popupExample').textContent=r.ex?'"'+r.ex+'"':'';
}

function closePopup(){document.getElementById('wordPopup').style.display='none';}
document.addEventListener('click',function(e){
  var p=document.getElementById('wordPopup');
  if(p.style.display==='block'&&!p.contains(e.target))closePopup();
});

// LIGHT / DARK MODE â€” default is deep navy (dark)
function toggleMode(){
  const body=document.body;
  const isDark=body.classList.contains('dark-mode');
  if(isDark){
    // Switch to light
    body.classList.remove('dark-mode');
    body.classList.add('light-mode');
    document.getElementById('modeIcon').textContent='ðŸŒ™';
    document.getElementById('modeLabel').textContent='Dark';
    localStorage.setItem('selah-bible-mode','light');
  } else {
    // Switch to dark (navy)
    body.classList.remove('light-mode');
    body.classList.add('dark-mode');
    document.getElementById('modeIcon').textContent='â˜€ï¸';
    document.getElementById('modeLabel').textContent='Light';
    localStorage.setItem('selah-bible-mode','dark');
  }
}
// Restore saved mode â€” default to light (the existing sky blue)
const savedMode=localStorage.getItem('selah-bible-mode');
if(savedMode==='dark'){
  document.body.classList.add('dark-mode');
  document.getElementById('modeIcon').textContent='â˜€ï¸';
  document.getElementById('modeLabel').textContent='Light';
} else if(savedMode==='light'){
  document.body.classList.add('light-mode');
  document.getElementById('modeIcon').textContent='ðŸŒ™';
  document.getElementById('modeLabel').textContent='Dark';
}
// No class = default sky blue (original Selah look)

// SHOOTING STARS
function spawnShootingStar(){
  const star=document.createElement('div');
  star.className='shooting-star';
  const startX=Math.random()*window.innerWidth;
  const startY=Math.random()*(window.innerHeight*0.6);
  const angle=25+Math.random()*20; // degrees below horizontal
  const dist=120+Math.random()*180;
  const rad=angle*Math.PI/180;
  const sx=Math.cos(rad)*dist+'px';
  const sy=Math.sin(rad)*dist+'px';
  const dur=0.6+Math.random()*0.6;
  star.style.cssText=`left:${startX}px;top:${startY}px;--sx:${sx};--sy:${sy};
    background:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,0.9),rgba(255,255,255,0));
    width:${40+Math.random()*60}px;height:1px;border-radius:1px;
    animation:shootStar ${dur}s ease-out forwards;`;
  document.body.appendChild(star);
  setTimeout(()=>star.remove(),(dur+0.1)*1000);
}
setInterval(()=>spawnShootingStar(),2200+Math.random()*2000);
// stagger a few on load
setTimeout(spawnShootingStar,600);
setTimeout(spawnShootingStar,1800);
setTimeout(spawnShootingStar,3200);

// INIT
buildSidebar();buildChSel();loadChapter();
</script>
</body>
</html>
