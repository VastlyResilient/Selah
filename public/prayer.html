<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Selah ‚Äî Prayer Wall</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;0,700;1,300;1,400;1,600&family=Jost:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --navy: #3a5a8f;
  --gold: #C6A75E;
  --gold-light: #D4B97A;
  --glass-bg: rgba(255,255,255,0.18);
  --glass-border: rgba(255,255,255,0.38);
  --glass-shadow: 0 12px 40px rgba(0,0,0,0.08);
  --text-muted: rgba(255,255,255,0.62);
}
*,*::before,*::after { box-sizing:border-box; margin:0; padding:0; }
html { scroll-behavior:smooth; }
body { font-family:'Jost',sans-serif; background:var(--navy); color:white; min-height:100vh; overflow-x:hidden; }

/* BG */
.bg-canvas { position:fixed; inset:0; z-index:0; overflow:hidden; }
.bg-gradient { position:absolute; inset:0; background:linear-gradient(145deg,#5a80c0 0%,#4a70b5 20%,#6080c8 40%,#4a6ab0 60%,#5070b8 100%); animation:breathe 45s ease-in-out infinite; }
@keyframes breathe { 0%,100%{filter:hue-rotate(0deg) brightness(1);} 33%{filter:hue-rotate(10deg) brightness(1.06);} 66%{filter:hue-rotate(-6deg) brightness(0.94);} }
.bg-blob { position:absolute; border-radius:50%; filter:blur(90px); opacity:0.2; animation:floatBlob 22s ease-in-out infinite; }
.blob1 { width:600px;height:600px;background:radial-gradient(circle,#C6A75E,transparent);top:-150px;left:-150px; }
.blob2 { width:500px;height:500px;background:radial-gradient(circle,#1e3a6f,transparent);bottom:0;right:-100px;animation-delay:-10s; }
@keyframes floatBlob { 0%,100%{transform:translate(0,0);} 50%{transform:translate(20px,-15px);} }
#particles { position:absolute; inset:0; pointer-events:none; }

.page { position:relative; z-index:1; }

/* NAV */
nav { position:fixed; top:0; left:0; right:0; z-index:100; padding:18px 60px; display:flex; align-items:center; justify-content:space-between; background:rgba(15,23,42,0.65); backdrop-filter:blur(24px); border-bottom:1px solid rgba(255,255,255,0.06); }
.nav-logo { font-family:'Cormorant Garamond',serif; font-size:1.7rem; font-weight:600; letter-spacing:0.06em; color:white; text-decoration:none; }
.nav-logo span { color:var(--gold); }
.nav-links { display:flex; gap:28px; list-style:none; }
.nav-links a { font-size:0.78rem; font-weight:500; letter-spacing:0.12em; text-transform:uppercase; color:rgba(255,255,255,0.45); text-decoration:none; transition:color 0.2s; }
.nav-links a:hover, .nav-links a.active { color:var(--gold); }
.nav-cta { padding:10px 22px; background:var(--gold); color:var(--navy); border:none; border-radius:100px; font-family:'Jost',sans-serif; font-size:0.78rem; font-weight:600; letter-spacing:0.1em; text-transform:uppercase; cursor:pointer; transition:all 0.2s; text-decoration:none; }
.nav-cta:hover { background:var(--gold-light); }

/* GLASS */
.glass { background:var(--glass-bg); backdrop-filter:blur(22px); -webkit-backdrop-filter:blur(22px); border:1px solid var(--glass-border); box-shadow:var(--glass-shadow),inset 0 1px 0 rgba(255,255,255,0.1); border-radius:20px; }

/* LAYOUT */
.container { max-width:1100px; margin:0 auto; padding:120px 60px 80px; }

/* HEADER */
.page-header { text-align:center; margin-bottom:56px; animation:fadeUp 0.8s ease both; }
.page-eyebrow { font-size:0.7rem; font-weight:600; letter-spacing:0.22em; text-transform:uppercase; color:var(--gold); margin-bottom:12px; }
.page-title { font-family:'Cormorant Garamond',serif; font-size:clamp(2.8rem,5vw,4.5rem); font-weight:600; line-height:1.05; margin-bottom:14px; }
.page-title em { font-style:italic; color:var(--gold); }
.page-sub { font-size:0.95rem; font-weight:300; color:var(--text-muted); line-height:1.8; max-width:520px; margin:0 auto; }

/* MAIN GRID */
.prayer-grid { display:grid; grid-template-columns:380px 1fr; gap:32px; align-items:start; }

/* SUBMIT FORM */
.submit-card { padding:32px; position:sticky; top:100px; }
.submit-card h3 { font-family:'Cormorant Garamond',serif; font-size:1.5rem; font-weight:600; margin-bottom:6px; }
.submit-card .sub { font-size:0.82rem; color:var(--text-muted); margin-bottom:24px; line-height:1.6; }

.form-field { margin-bottom:16px; }
.form-field label { display:block; font-size:0.63rem; font-weight:600; letter-spacing:0.14em; text-transform:uppercase; color:rgba(255,255,255,0.38); margin-bottom:7px; }
.form-field input, .form-field select, .form-field textarea {
  width:100%; padding:12px 14px;
  background:rgba(255,255,255,0.06);
  border:1px solid rgba(255,255,255,0.1);
  border-radius:12px;
  font-family:'Jost',sans-serif; font-size:0.88rem; color:white;
  transition:all 0.2s; appearance:none; resize:none;
}
.form-field input::placeholder, .form-field textarea::placeholder { color:rgba(255,255,255,0.28); }
.form-field input:focus, .form-field select:focus, .form-field textarea:focus { outline:none; border-color:var(--gold); background:rgba(255,255,255,0.09); }
.form-field select option { background:#1a2744; }
.select-wrap { position:relative; }
.select-wrap::after { content:'‚ñæ'; position:absolute; right:12px; top:50%; transform:translateY(-50%); color:var(--gold); pointer-events:none; }

.anon-toggle { display:flex; align-items:center; gap:10px; margin-bottom:16px; cursor:pointer; }
.anon-toggle input[type="checkbox"] { width:18px; height:18px; accent-color:var(--gold); cursor:pointer; }
.anon-toggle span { font-size:0.82rem; color:rgba(255,255,255,0.55); }

.submit-btn {
  width:100%; padding:14px;
  background:var(--gold); color:var(--navy);
  border:none; border-radius:12px;
  font-family:'Cormorant Garamond',serif; font-size:1.1rem; font-weight:700;
  cursor:pointer; transition:all 0.25s cubic-bezier(0.16,1,0.3,1);
  margin-top:4px;
}
.submit-btn:hover { background:var(--gold-light); transform:translateY(-2px); box-shadow:0 8px 28px rgba(198,167,94,0.45); }
.submit-btn:disabled { opacity:0.55; cursor:not-allowed; transform:none; }

.form-success { display:none; text-align:center; padding:16px 0; }
.form-success .icon { font-size:2.2rem; margin-bottom:10px; }
.form-success h4 { font-family:'Cormorant Garamond',serif; font-size:1.5rem; margin-bottom:8px; }
.form-success p { font-size:0.83rem; color:var(--text-muted); line-height:1.7; }
.form-success .again-btn { margin-top:16px; background:none; border:1px solid rgba(198,167,94,0.35); color:var(--gold); padding:9px 20px; border-radius:100px; font-family:'Jost',sans-serif; font-size:0.78rem; font-weight:600; letter-spacing:0.08em; cursor:pointer; transition:all 0.2s; }
.form-success .again-btn:hover { background:rgba(198,167,94,0.12); }

.form-error { background:rgba(239,68,68,0.12); border:1px solid rgba(239,68,68,0.28); border-radius:8px; padding:10px 14px; font-size:0.8rem; color:#fca5a5; margin-bottom:12px; display:none; }

/* PRAYER WALL */
.wall-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:20px; }
.wall-title { font-family:'Cormorant Garamond',serif; font-size:1.6rem; font-weight:600; }
.prayer-count { font-size:0.75rem; font-weight:600; letter-spacing:0.1em; text-transform:uppercase; color:var(--gold); background:rgba(198,167,94,0.1); border:1px solid rgba(198,167,94,0.25); padding:5px 14px; border-radius:100px; }

.filter-chips { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:24px; }
.filter-chip { padding:6px 14px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.08); border-radius:100px; font-size:0.72rem; font-weight:500; color:rgba(255,255,255,0.5); cursor:pointer; transition:all 0.2s; }
.filter-chip:hover, .filter-chip.active { background:rgba(198,167,94,0.15); border-color:var(--gold); color:white; }

.prayers-list { display:flex; flex-direction:column; gap:14px; }

.prayer-card {
  padding:22px 24px;
  animation:fadeUp 0.6s ease both;
  transition:transform 0.25s cubic-bezier(0.16,1,0.3,1), box-shadow 0.25s;
}
.prayer-card:hover { transform:translateY(-3px); box-shadow:0 16px 48px rgba(0,0,0,0.22); }

.prayer-meta { display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; gap:12px; }
.prayer-author { display:flex; align-items:center; gap:10px; }
.prayer-avatar {
  width:34px; height:34px; border-radius:50%;
  background:rgba(198,167,94,0.18); border:1px solid rgba(198,167,94,0.3);
  display:flex; align-items:center; justify-content:center;
  font-family:'Cormorant Garamond',serif; font-size:0.95rem; font-weight:600; color:var(--gold);
  flex-shrink:0;
}
.prayer-name { font-size:0.88rem; font-weight:500; color:white; }
.prayer-time { font-size:0.68rem; color:rgba(255,255,255,0.28); margin-top:2px; }
.prayer-category-tag { padding:3px 11px; background:rgba(198,167,94,0.1); border:1px solid rgba(198,167,94,0.2); border-radius:100px; font-size:0.65rem; font-weight:600; letter-spacing:0.1em; text-transform:uppercase; color:var(--gold); flex-shrink:0; }

.prayer-text { font-family:'Cormorant Garamond',serif; font-size:1.05rem; font-style:italic; color:rgba(255,255,255,0.82); line-height:1.75; margin-bottom:14px; }

.prayer-actions { display:flex; align-items:center; gap:12px; }
.prayed-btn {
  display:flex; align-items:center; gap:7px;
  padding:7px 16px;
  background:rgba(255,255,255,0.05);
  border:1px solid rgba(255,255,255,0.1);
  border-radius:100px;
  font-family:'Jost',sans-serif; font-size:0.75rem; font-weight:500; color:rgba(255,255,255,0.55);
  cursor:pointer; transition:all 0.25s cubic-bezier(0.16,1,0.3,1);
}
.prayed-btn:hover { background:rgba(198,167,94,0.15); border-color:rgba(198,167,94,0.4); color:white; transform:scale(1.04); }
.prayed-btn.prayed { background:rgba(198,167,94,0.18); border-color:var(--gold); color:var(--gold); }
.prayed-btn .hands { font-size:0.9rem; }
.prayed-count { font-weight:600; }

.prayer-divider { height:1px; background:rgba(255,255,255,0.05); margin:2px 0; }

/* EMPTY STATE */
.empty-state { text-align:center; padding:48px 24px; color:var(--text-muted); }
.empty-state .icon { font-size:2.5rem; margin-bottom:12px; opacity:0.5; }
.empty-state p { font-size:0.88rem; line-height:1.7; }

/* LOADING */
.loading { text-align:center; padding:32px; color:var(--text-muted); font-size:0.88rem; }

/* ANIMATIONS */
@keyframes fadeUp { from{opacity:0;transform:translateY(18px);} to{opacity:1;transform:translateY(0);} }

/* RESPONSIVE */
@media(max-width:860px) {
  nav { padding:14px 20px; }
  .nav-links { display:none; }
  .container { padding:100px 20px 60px; }
  .prayer-grid { grid-template-columns:1fr; }
  .submit-card { position:static; }
}
</style>
</head>
<body>

<div class="bg-canvas">
  <div class="bg-gradient"></div>
  <div class="bg-blob blob1"></div>
  <div class="bg-blob blob2"></div>
  <canvas id="particles"></canvas>
</div>

<div class="page">

<nav>
  <a href="/" class="nav-logo"><span>S</span>elah</a>
  <ul class="nav-links">
    <li><a href="/">Home</a></li>
    <li><a href="/#how">How it works</a></li>
    <li><a href="/#faq">Questions</a></li>
    <li><a href="/prayer.html" class="active">Prayer Wall</a></li>
  </ul>
  
</nav>

<div class="container">

  <div class="page-header">
    <div class="page-eyebrow">Community ¬∑ Prayer</div>
    <h1 class="page-title">The Prayer <em>Wall</em></h1>
    <p class="page-sub">Submit a prayer request and let the Selah community stand with you. Every request is seen. Every name remembered ‚Äî or kept anonymous, if you prefer.</p>
  </div>

  <div class="prayer-grid">

    <!-- SUBMIT FORM -->
    <div class="submit-card glass">
      <div id="formView">
        <h3>Share Your Request</h3>
        <p class="sub">Your prayer will be visible to the community. Submit anonymously if you prefer.</p>

        <div class="form-field">
          <label>Your Name</label>
          <input type="text" id="prayerName" placeholder="Your first name" />
        </div>

        <label class="anon-toggle">
          <input type="checkbox" id="anonCheck" onchange="toggleAnon()" />
          <span>Submit anonymously</span>
        </label>



        <div class="form-field">
          <label>Prayer Request</label>
          <textarea id="prayerRequest" rows="5" placeholder="Share what's on your heart..."></textarea>
        </div>

        <div class="form-error" id="formError"></div>

        <button class="submit-btn" id="submitBtn" onclick="submitPrayer()">
          üôè Submit Prayer Request
        </button>
      </div>

      <div class="form-success" id="formSuccess">
        <div class="icon">üïäÔ∏è</div>
        <h4>Prayer submitted</h4>
        <p>Your request has been shared with the Selah community. You are not alone in this.</p>
        <button class="again-btn" onclick="resetForm()">Submit another request</button>
      </div>
    </div>

    <!-- PRAYER WALL -->
    <div>
      <div class="wall-header">
        <div class="wall-title">Community Prayers</div>
        <div class="prayer-count" id="prayerCount">0 prayers</div>
      </div>



      <div class="loading" id="loadingState">Loading prayers...</div>
      <div class="prayers-list" id="prayersList"></div>
    </div>

  </div>
</div>
</div>

<script>
// PARTICLES
const canvas=document.getElementById('particles'),ctx=canvas.getContext('2d');
let parts=[];
function resize(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;}
function initParts(){parts=[];for(let i=0;i<45;i++)parts.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*1.3+0.3,o:Math.random()*0.22+0.04,vx:(Math.random()-.5)*0.12,vy:-Math.random()*0.16-0.04});}
function drawParts(){ctx.clearRect(0,0,canvas.width,canvas.height);parts.forEach(p=>{ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fillStyle=`rgba(198,167,94,${p.o})`;ctx.fill();p.x+=p.vx;p.y+=p.vy;if(p.y<-5)p.y=canvas.height+5;if(p.x<-5)p.x=canvas.width+5;if(p.x>canvas.width+5)p.x=-5;});requestAnimationFrame(drawParts);}
resize();initParts();drawParts();
window.addEventListener('resize',()=>{resize();initParts();});

// STATE
let allPrayers = [];
let currentFilter = 'all';
const prayedIds = new Set(JSON.parse(localStorage.getItem('selah_prayed') || '[]'));

function savePrayedIds() {
  localStorage.setItem('selah_prayed', JSON.stringify([...prayedIds]));
}

// LOAD PRAYERS
async function loadPrayers() {
  try {
    const res = await fetch('/api/prayers');
    allPrayers = await res.json();
    renderPrayers();
  } catch(e) {
    document.getElementById('loadingState').textContent = 'Could not load prayers.';
  }
}

function renderPrayers() {
  const list = document.getElementById('prayersList');
  const loading = document.getElementById('loadingState');
  loading.style.display = 'none';

  const filtered = currentFilter === 'all'
    ? allPrayers
    : allPrayers.filter(p => p.category === currentFilter);

  document.getElementById('prayerCount').textContent =
    allPrayers.length + (allPrayers.length === 1 ? ' prayer' : ' prayers');

  if (filtered.length === 0) {
    list.innerHTML = `<div class="empty-state"><div class="icon">üïäÔ∏è</div><p>No prayers in this category yet.<br>Be the first to share your heart.</p></div>`;
    return;
  }

  list.innerHTML = '';
  filtered.forEach((p, i) => {
    const hasPrayed = prayedIds.has(p.id);
    const initial = p.name === 'Anonymous' ? 'üôè' : p.name.charAt(0).toUpperCase();
    const timeAgo = getTimeAgo(p.createdAt);

    const card = document.createElement('div');
    card.className = 'prayer-card glass';
    card.style.animationDelay = (i * 0.06) + 's';
    card.innerHTML = `
      <div class="prayer-meta">
        <div class="prayer-author">
          <div class="prayer-avatar">${initial}</div>
          <div>
            <div class="prayer-name">${p.name}</div>
            <div class="prayer-time">${timeAgo}</div>
          </div>
        </div>
      </div>
      <div class="prayer-text">"${p.request}"</div>
      <div class="prayer-actions">
        <button class="prayed-btn ${hasPrayed ? 'prayed' : ''}" id="prayed-${p.id}" onclick="iPrayed('${p.id}')">
          <span class="hands">üôè</span>
          <span class="prayed-count">${p.prayedCount || 0}</span>
          <span>${hasPrayed ? 'Prayed' : 'I Prayed'}</span>
        </button>
      </div>`;
    list.appendChild(card);
  });
}

function filterPrayers(btn, cat) {
  document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
  btn.classList.add('active');
  currentFilter = cat;
  renderPrayers();
}

async function iPrayed(id) {
  if (prayedIds.has(id)) return; // already prayed
  prayedIds.add(id);
  savePrayedIds();

  const btn = document.getElementById('prayed-' + id);
  if (btn) {
    btn.classList.add('prayed');
    btn.querySelector('span:last-child').textContent = 'Prayed';
  }

  try {
    const res = await fetch('/api/prayers/' + id + '/prayed', { method: 'POST' });
    const data = await res.json();
    if (btn) btn.querySelector('.prayed-count').textContent = data.prayedCount;
    // Update in local array too
    const prayer = allPrayers.find(p => p.id === id);
    if (prayer) prayer.prayedCount = data.prayedCount;
  } catch(e) { console.error(e); }
}

// SUBMIT PRAYER
function toggleAnon() {
  const checked = document.getElementById('anonCheck').checked;
  const nameField = document.getElementById('prayerName');
  nameField.disabled = checked;
  nameField.value = checked ? '' : nameField.value;
  nameField.placeholder = checked ? 'Submitting anonymously' : 'Your first name';
  nameField.style.opacity = checked ? '0.4' : '1';
}

async function submitPrayer() {
  const isAnon = document.getElementById('anonCheck').checked;
  const name = isAnon ? 'Anonymous' : document.getElementById('prayerName').value.trim();
  const request = document.getElementById('prayerRequest').value.trim();
  const errEl = document.getElementById('formError');
  errEl.style.display = 'none';

  if (!request) { errEl.textContent = 'Please share your prayer request.'; errEl.style.display = 'block'; return; }

  const btn = document.getElementById('submitBtn');
  btn.disabled = true; btn.textContent = 'Submitting...';

  try {
    const res = await fetch('/api/prayers', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, request }),
    });
    const data = await res.json();
    if (!res.ok) { errEl.textContent = data.error || 'Something went wrong.'; errEl.style.display = 'block'; btn.disabled = false; btn.innerHTML = 'üôè Submit Prayer Request'; return; }

    // Add to top of list
    allPrayers.unshift(data.prayer);
    renderPrayers();

    document.getElementById('formView').style.display = 'none';
    document.getElementById('formSuccess').style.display = 'block';
  } catch(e) {
    errEl.textContent = 'Network error. Please try again.';
    errEl.style.display = 'block';
    btn.disabled = false;
    btn.innerHTML = 'üôè Submit Prayer Request';
  }
}

function resetForm() {
  document.getElementById('formView').style.display = 'block';
  document.getElementById('formSuccess').style.display = 'none';
  document.getElementById('prayerName').value = '';
  document.getElementById('prayerRequest').value = '';
  document.getElementById('anonCheck').checked = false;
  document.getElementById('prayerCategory').value = 'General';
  document.getElementById('submitBtn').disabled = false;
  document.getElementById('submitBtn').innerHTML = 'üôè Submit Prayer Request';
  toggleAnon();
}

// TIME AGO
function getTimeAgo(iso) {
  const diff = Date.now() - new Date(iso).getTime();
  const m = Math.floor(diff / 60000);
  if (m < 1) return 'Just now';
  if (m < 60) return m + 'm ago';
  const h = Math.floor(m / 60);
  if (h < 24) return h + 'h ago';
  const d = Math.floor(h / 24);
  if (d < 7) return d + 'd ago';
  return new Date(iso).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
}

loadPrayers();
</script>
</body>
</html>
